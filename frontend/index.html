<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | 'à¤¹à¤®à¤¾à¤°à¥€ à¤°à¤¸à¥‹à¤ˆ'</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
</head>

<body>

  <header>
    <h1 style="color: aliceblue;">'à¤¹à¤®à¤¾à¤°à¥€ à¤°à¤¸à¥‹à¤ˆ'</h1>
    <nav id="navbar">
      <a href="index.html" class="active">Home</a>
      <a href="donor.html">Donor</a>
      <a href="request.html">Request</a>
      <a href="select.html">Select Page</a>
      <!-- Profile & Logout will be added dynamically -->
    </nav>
  </header>

  <section class="hero">
    <h2>Save Food, Save Lives</h2>
    <p>Connecting donors and those in need through kindness and action.</p>
    <a href="donor.html" class="cta-button">Donate Now</a>
  </section>

  <!-- Hidden Profile Section -->
  <section id="profileSection" style="display:none; max-width:600px; margin:20px auto; padding:20px; background:#f9f9f9; border-radius:10px;">
    <h2>ðŸ‘¤ User Profile</h2>
    <p><strong>Name:</strong> <span id="profileName"></span></p>
    <p><strong>Email:</strong> <span id="profileEmail"></span></p>
    <p><strong>Role:</strong> <span id="profileRole"></span></p>

    <div id="donorSection" style="display:none; margin-top:20px;">
      <h3>Upload Shop Images</h3>
      <input type="file" id="shopImage" multiple>
      <button id="uploadBtn">Upload</button>
      <div id="uploadedImages" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;"></div>
    </div>

    <div id="requesterSection" style="display:none; margin-top:20px;">
      <h3>Share Happy Memories</h3>
      <textarea id="memoryInput" placeholder="Write something..." style="width:100%; height:100px; padding:10px;"></textarea>
      <button id="shareBtn">Share</button>
      <div id="memoriesList" style="margin-top:10px;"></div>
    </div>
  </section>

  <footer>
    <p>&copy; 2025 Food Management. All rights reserved.</p>
  </footer>

  <script>
    const SERVER_URL = "http://localhost:5001";

    document.addEventListener("DOMContentLoaded", async () => {
      const user = JSON.parse(localStorage.getItem("user"));
      const nav = document.getElementById("navbar");
      const profileSection = document.getElementById("profileSection");

      if (user) {
        // Create Profile Link
        const profileLink = document.createElement("a");
        profileLink.href = "#";
        profileLink.textContent = "Profile";
        profileLink.addEventListener("click", async (e) => {
          e.preventDefault();
          await showProfile(user);
        });
        nav.appendChild(profileLink);

        // Create Logout Link
        // const logoutLink = document.createElement("a");
        // logoutLink.href = "#";
        // logoutLink.textContent = "Logout";
        // logoutLink.addEventListener("click", () => {
        //   localStorage.removeItem("user");
        //   window.location.reload();
        // });
        // nav.appendChild(logoutLink);
      }

      async function showProfile(user) {
        profileSection.style.display = "block";
        try {
          const res = await fetch(`${SERVER_URL}/api/user/profile/${user.id}`);
          const data = await res.json();

          document.getElementById("profileName").textContent = data.name;
          document.getElementById("profileEmail").textContent = data.email;
          document.getElementById("profileRole").textContent = data.role;

          // Toggle donor/requester section
          if (data.role === "donor") {
            document.getElementById("donorSection").style.display = "block";
            document.getElementById("requesterSection").style.display = "none";
          } else {
            document.getElementById("donorSection").style.display = "none";
            document.getElementById("requesterSection").style.display = "block";
          }
        } catch (err) {
          console.error("Error loading profile:", err);
        }
      }
    });
  </script>
</body>
</html>
